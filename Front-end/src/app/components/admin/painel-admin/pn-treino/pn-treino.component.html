@if (isLoading) {
<app-modal-spinner></app-modal-spinner>
}

<div class="p-4">
    <div class="d-flex align-items-center gap-2 mb-3">
        <h1 class="hi-treino mb-0">Fichas de Treino</h1>
        <i class="fa-regular fa-circle-question help-icon fs-4" 
           matTooltip="Gerencie as prescrições de exercícios dos alunos. Visualize quem já possui ficha ativa ou crie novas rotinas."></i>
    </div>

    <div class="alert alert-info mb-4">
        <i class="fa-solid fa-circle-info me-2"></i>
        Utilize a barra de busca para encontrar um cliente. Aqui você pode ver quem já possui ficha cadastrada ou criar uma nova.
    </div>

    <div class="my-3">
        <div class="d-flex flex-wrap gap-3 align-items-center">
<!-- 
            <div class="d-flex align-items-center flex-grow-1" style="max-width: 400px;">
                <div class="input-group">
                    <span class="input-group-text">
                        <i class="fa-solid fa-magnifying-glass"></i>
                    </span>
                    <input type="text" class="form-control" placeholder="Buscar por nome, email ou status...">
                </div>
                <i class="fa-regular fa-circle-question help-icon ms-2" 
                   matTooltip="Pesquise pelo nome do aluno para verificar rapidamente a situação da ficha de treino dele."></i>
            </div> -->

            <div class="d-flex align-items-center gap-2 ms-auto">
                <!-- <div class="d-flex align-items-center">
                    <button class="btn btn-outline-secondary d-flex align-items-center gap-2">
                        <i class="fa-solid fa-file-export"></i>
                        Exportar
                    </button>
                    <i class="fa-regular fa-circle-question help-icon ms-2" 
                       matTooltip="Baixa um relatório em Excel/PDF com a lista atual de fichas."></i>
                </div> -->

                <!-- <div class="d-flex align-items-center">
                    <button class="btn btn-primary d-flex align-items-center gap-2" onclick="openModal()">
                        <i class="fa-solid fa-plus"></i>
                        Nova Ficha
                    </button>
                    <i class="fa-regular fa-circle-question help-icon ms-2" 
                       matTooltip="Inicia o processo de criação de uma nova ficha de treino do zero."></i>
                </div> -->
            </div>
        </div>

        <!-- <div class="mt-3 d-flex align-items-center gap-2">
            <div class="btn-group" role="group">
                <button type="button" class="btn btn-outline-primary active">Todos</button>
                <button type="button" class="btn btn-outline-primary">Fichas Ativas</button>
                <button type="button" class="btn btn-outline-primary">Fichas Pendentes</button>
                <button type="button" class="btn btn-outline-primary">Cadastrados Hoje</button>
                <button type="button" class="btn btn-outline-primary">Vencimento Próximo</button>
            </div>
            <i class="fa-regular fa-circle-question help-icon" 
               matTooltip="Filtre a lista para focar em grupos específicos de alunos, como os que precisam renovar o treino."></i>
        </div> -->
    </div>

    <table class="table table-bordered table-striped mt-4">
        <thead class="thead-dark">
            <tr>
                <th>Nome do Aluno</th>
                <th>Email</th>
                <th>
                    Status da Ficha
                    <i class="fa-regular fa-circle-question help-icon ms-1 text-white" 
                       matTooltip="Indica se o aluno já tem um treino vinculado ao perfil dele."></i>
                </th>
                <th>
                    Ações
                    <i class="fa-regular fa-circle-question help-icon ms-1 text-white" 
                       matTooltip="Opções de gerenciamento da ficha."></i>
                </th>
            </tr>
        </thead>

        <tbody>
            <tr *ngFor="let cliente of clientesFiltrados 
            | paginate: { itemsPerPage: itensPorPagina, currentPage: paginaAtual }">

                <td>{{ cliente.nome }}</td>
                <td>{{ cliente.email }}</td>

                <td>
                    <span [ngClass]="cliente.temFicha ? 'text-success' : 'text-danger'" class="fw-bold">
                        {{ cliente.temFicha ? '✅ Possui' : '❌ Não possui' }}
                    </span>
                </td>

                <td>
                    @if (cliente.temFicha) {
                    <button class="btn btn-primary btn-sm me-2" [routerLink]="['ver-fichas']"
                        [queryParams]="{ id: cliente.id }"
                        matTooltip="Visualizar os exercícios e detalhes da ficha atual.">
                        Ver Fichas
                    </button>

                    <button class="btn btn-secondary btn-sm me-2" [routerLink]="['cad-ficha']"
                        [queryParams]="{ id: cliente.id }"
                        matTooltip="Alterar exercícios ou atualizar a ficha existente.">
                        Editar ficha
                    </button>
                    }

                    <button *ngIf="!cliente.temFicha" class="btn btn-success btn-sm" [routerLink]="['cad-ficha']"
                        [queryParams]="{ id: cliente.id }"
                        matTooltip="O aluno está sem treino. Clique para criar a primeira ficha.">
                        Cadastrar Ficha
                    </button>
                </td>
            </tr>
        </tbody>
    </table>

    <!-- PAGINAÇÃO DO NGX -->
    <div class="d-flex justify-content-between align-items-center mt-3">
        <pagination-controls class="pagination" (pageChange)="paginaAtual = $event" previousLabel="Anterior"
            nextLabel="Próximo">
        </pagination-controls>
        
        <i class="fa-regular fa-circle-question help-icon" 
           matTooltip="Navegue entre as páginas de resultados."></i>
    </div>
    
</div>