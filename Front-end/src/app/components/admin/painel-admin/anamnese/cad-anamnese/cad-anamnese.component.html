<div class="container mt-4" [formGroup]="anamneseForm">
    <div class="d-flex align-items-center gap-2 mb-4">
        <h2>Formulário de Anamnese</h2>
        <i class="fa-regular fa-circle-question help-icon fs-5" 
           matTooltip="Preencha a ficha de avaliação inicial para registrar o histórico de saúde do aluno."></i>
    </div>

    <!-- Seleção do Cliente -->
    <div class="mb-4 p-3 bg-light rounded border">
        <div class="d-flex align-items-center mb-2">
            <label for="cliente" class="form-label mb-0 fw-bold">Selecione o Cliente</label>
            <i class="fa-regular fa-circle-question help-icon ms-2" 
               matTooltip="Escolha o aluno para o qual esta anamnese será registrada. A lista exibe apenas clientes ativos."></i>
        </div>
        <select class="form-select" formControlName="cliente_id" required>
            <option value="" disabled selected>-- Selecione um cliente --</option>
            @for (cliente of clientes; track $index) {
            <option [value]="cliente.id">{{ cliente.nome }}</option>
            }
        </select>
    </div>


    <!-- Formulário de Anamnese -->
    <form [formGroup]="anamneseForm" *ngIf="anamneseForm.get('cliente_id')!.value"
        (ngSubmit)="salvarAnamnese()">

        <div class="mb-3">
            <div class="d-flex align-items-center mb-2">
                <label class="form-label mb-0 me-2">1. Um médico já lhe disse que você tinha alguns dos problemas abaixo?</label>
                <i class="fa-regular fa-circle-question help-icon" 
                   matTooltip="Marque todas as condições diagnosticadas clinicamente."></i>
            </div>
            <div class="row">
                <div class="col-md-4" *ngFor="let problema of problemasSaude">
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" [value]="problema"
                            (change)="onCheckboxChange($event,'perg_problemas_saude' )">
                        <label class="form-check-label ms-2">{{ problema }}</label>
                    </div>
                </div>
                <label class="form-check-label my-2">Por favor explique: </label>
                <input class="form-control" type="text" (change)="onTextChange($event,'perg_problemas_saude')" placeholder="Detalhes sobre o diagnóstico...">
            </div>
        </div>

        <div class="mb-3">
            <div class="d-flex align-items-center mb-2">
                <label class="form-label mb-0 me-2">2. Você tem algum dos sintomas abaixo?</label>
                <i class="fa-regular fa-circle-question help-icon" 
                   matTooltip="Sintomas frequentes ou recentes que podem afetar o treino."></i>
            </div>
            <div class="row">
                <div class="col-md-4" *ngFor="let sintoma of sintomasLista">
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" [value]="sintoma"
                            (change)="onCheckboxChange($event,'perg_sintomas' )">
                        <label class="form-check-label ms-2">{{ sintoma }}</label>
                    </div>
                </div>
                <label class="form-check-label my-2">Por favor explique: </label>
                <input class="form-control" type="text" (change)="onTextChange($event,'perg_sintomas')">
            </div>
        </div>

        <div class="mb-3">
            <div class="d-flex align-items-center mb-2">
                <label class="form-label mb-0 me-2">3. Liste os medicamentos que você está tomando (nome e motivo)</label>
                <i class="fa-regular fa-circle-question help-icon" 
                   matTooltip="Importante para identificar possíveis efeitos colaterais durante o exercício."></i>
            </div>
            <textarea class="form-control" formControlName="perg_medicamentos" rows="2"></textarea>
        </div>

        <div class="mb-3">
            <div class="d-flex align-items-center mb-2">
                <label class="form-label mb-0 me-2">4. Algum parente próximo teve ataque cardíaco antes dos 50 anos?</label>
                <i class="fa-regular fa-circle-question help-icon" 
                   matTooltip="Considere pais ou irmãos (parentes de primeiro grau)."></i>
            </div>
            <div class="d-flex gap-3">
                <div class="form-check">
                    <input class="form-check-input" type="radio" value="1" formControlName="perg_historico_familiar_cardiaco">
                    <label class="form-check-label">Sim</label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="radio" value="0" formControlName="perg_historico_familiar_cardiaco">
                    <label class="form-check-label">Não</label>
                </div>
            </div>
        </div>

        <div class="mb-3">
            <div class="d-flex align-items-center mb-2">
                <label class="form-label mb-0 me-2">5. Algum médico disse que você tinha alguma restrição à prática de atividades físicas?</label>
                <i class="fa-regular fa-circle-question help-icon" 
                   matTooltip="Descreva cirurgias recentes ou movimentos proibidos."></i>
            </div>
            <input type="text" class="form-control" formControlName="perg_restricao_medica">
        </div>

        <div class="mb-3">
            <label class="form-label">6. Você está grávida?</label>
            <div class="d-flex gap-3">
                <div class="form-check">
                    <input class="form-check-input" type="radio" value="1" formControlName="perg_gravida">
                    <label class="form-check-label">Sim</label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="radio" value="0" formControlName="perg_gravida">
                    <label class="form-check-label">Não</label>
                </div>
            </div>
        </div>

        <div class="mb-3">
            <label class="form-label">7. Você fuma?</label>
            <input type="text" class="form-control" formControlName="perg_fuma" placeholder="Não ou quantidade por dia">
        </div>

        <div class="mb-3">
            <label class="form-label">8. Você ingere bebidas alcoólicas?</label>
            <input type="text" class="form-control" formControlName="perg_bebe_alcool" placeholder="Frequência (Socialmente, Fim de semana, etc)">
        </div>

        <div class="mb-3">
            <div class="d-flex align-items-center mb-2">
                <label class="form-label mb-0 me-2">9. Atualmente você tem se exercitado pelo menos 2 vezes por semana?</label>
                <i class="fa-regular fa-circle-question help-icon" 
                   matTooltip="Define se o aluno é sedentário ou ativo."></i>
            </div>
            <div class="d-flex gap-3">
                <div class="form-check">
                    <input class="form-check-input" type="radio" value="1" formControlName="perg_exercicio_frequente">
                    <label class="form-check-label">Sim</label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="radio" value="0" formControlName="perg_exercicio_frequente">
                    <label class="form-check-label">Não</label>
                </div>
            </div>
        </div>

        <div class="mb-3">
            <div class="d-flex align-items-center mb-2">
                <label class="form-label mb-0 me-2">10. Total de minutos dispensados em atividades aeróbicas por semana:</label>
                <i class="fa-regular fa-circle-question help-icon" 
                   matTooltip="Ex: Caminhada, corrida, natação, bicicleta."></i>
            </div>
            <input type="number" class="form-control" formControlName="perg_qtde_aerobico">
        </div>

        <div class="mb-3">
            <label class="form-label">11. Você mediu sua taxa de colesterol no ano passado?</label>
            <div class="d-flex gap-3">
                <div class="form-check">
                    <input class="form-check-input" type="radio" value="0" formControlName="perg_colesterol_medido">
                    <label class="form-check-label">Sim</label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="radio" value="1" formControlName="perg_colesterol_medido">
                    <label class="form-check-label">Não</label>
                </div>
            </div>
        </div>

        <div class="mb-3">
            <div class="d-flex align-items-center mb-2">
                <label class="form-label mb-0 me-2">12. Você come alimentos dos 4 maiores grupos alimentares?</label>
                <i class="fa-regular fa-circle-question help-icon" 
                   matTooltip="Proteínas, Carboidratos, Gorduras boas, Vitaminas/Minerais."></i>
            </div>
            <div class="d-flex gap-3">
                <div class="form-check">
                    <input class="form-check-input" type="radio" value="0" formControlName="perg_alimentacao_balanceada">
                    <label class="form-check-label">Sim</label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="radio" value="1" formControlName="perg_alimentacao_balanceada">
                    <label class="form-check-label">Não</label>
                </div>
            </div>
        </div>

        <div class="mb-3">
            <label class="form-label">13. Sua dieta tem alto teor de gordura saturada?</label>
            <div class="d-flex gap-3">
                <div class="form-check">
                    <input class="form-check-input" type="radio" value="1" formControlName="perg_gordura_alta">
                    <label class="form-check-label">Sim</label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="radio" value="0" formControlName="perg_gordura_alta">
                    <label class="form-check-label">Não</label>
                </div>
            </div>
        </div>

        <div class="mb-3">
            <div class="d-flex align-items-center mb-2">
                <label class="form-label mb-0 me-2">14. Qual seu nível de estresse?</label>
                <i class="fa-regular fa-circle-question help-icon" 
                   matTooltip="Autoavaliação do estresse diário (Trabalho/Rotina)."></i>
            </div>
            <select class="form-select" formControlName="perg_nivel_estresse">
                <option value="leve">Leve</option>
                <option value="moderado">Moderado</option>
                <option value="elevado">Elevado</option>
                <option value="constante">Constante</option>
            </select>
        </div>

        <div class="mb-3">
            <div class="d-flex align-items-center mb-2">
                <label class="form-label mb-0 me-2">15. Quais são seus objetivos ao ingressar em um grupo de promoção de saúde?</label>
                <i class="fa-regular fa-circle-question help-icon" 
                   matTooltip="Informação crucial para a montagem da ficha de treino."></i>
            </div>
            <div class="row">
                <div class="col-md-4" *ngFor="let objetivo of objetivos">
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" [value]="objetivo"
                            (change)="onCheckboxChange($event,'perg_objetivos_saude' )">
                        <label class="form-check-label ms-2">{{ objetivo }}</label>
                    </div>
                </div>
                <label class="form-check-label mt-4 mb-2">Se outro(explique): </label>
                <input class="form-control" type="text" (change)="onTextChange($event,'perg_objetivos_saude')">
            </div>
        </div>

        <div class="mb-3">
            <div class="d-flex align-items-center mb-2">
                <label class="form-label mb-0 me-2">Anotações:</label>
                <i class="fa-regular fa-circle-question help-icon" 
                   matTooltip="Observações extras do avaliador ou do aluno."></i>
            </div>
            <textarea class="form-control" type="text" rows="3" formControlName="anotacoes"></textarea>
        </div>

        <div class="d-flex align-items-center mb-5">
            <button type="submit" class="btn btn-primary">Salvar</button>
            <i class="fa-regular fa-circle-question help-icon ms-3" 
               matTooltip="Salva a anamnese e vincula ao cliente selecionado."></i>
        </div>
    </form>
</div>