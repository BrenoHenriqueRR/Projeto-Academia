<div class="fundo">
    <div *ngIf="loading">
        <app-modal-spinner></app-modal-spinner>
    </div>
    <div class="container">

        <div *ngIf="loading == true" class="spinner-container">
            <span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>
        </div>
        <h1 class="h1-cli">Listagem de Clientes</h1>
        <div class="my-4 d-flex justify-content-between align-items-center">
            <div class="d-flex gap-5">
                <div>
                    <button class="btn btn-primary" (click)="abrirModalExibir()">
                        + Adicionar
                    </button>
                    <i class="fa-regular fa-circle-question help-icon"
                        matTooltip="Cadastra um novo cliente no sistema."></i>
                </div>
                <div class="">
                    <button type="button" class="btn btn-primary" routerLink="anamnese"><i
                            class="fas fa-notes-medical mx-2"></i>Anamnese</button>
                    <i class="fa-regular fa-circle-question help-icon"
                        matTooltip="Formulário de avaliação inicial do cliente."></i>
                </div>
                <div class="">
                    <button type="button" class="btn btn-primary" routerLink="pagamentos"><i
                            class="fa-solid fa-sack-dollar mx-2"></i>Pagamentos</button>
                    <i class="fa-regular fa-circle-question help-icon"
                        matTooltip="Financeiro do cliente: mensalidades e débitos."></i>
                </div>

            </div>
            <app-modal-cadastro (CloseModal)="Closemodal()" tipo="cliente"></app-modal-cadastro>
            <div class="">
                <button type="button" class="btn btn-primary" (click)="abrirModalRelatorios('relatorioClientes', null)">
                    <i class="fa-solid fa-chart-line mx-2"></i> Relatórios <i
                        class="fa-regular fa-circle-question help-icon"
                        matTooltip="Relatórios de presença, pagamentos, treinos e mais."></i>
                </button>
            </div>
        </div>
        <div class="row justify-content-between g-3 mb-3">
            <div class="col-md-2">
                <label for="statusFiltro" class="form-label">Filtrar por status:</label>
                <div class="d-flex">
                    <select id="statusFiltro" class="form-select" [(ngModel)]="filtroStatus"
                        (change)="aplicarFiltros()">
                        <option value="ativo">Ativos</option>
                        <option value="inativo">Inativos</option>
                    </select>
                    <i class="fa-regular fa-circle-question help-icon"
                        matTooltip="Mostra clientes ativos ou inativos."></i>
                </div>
            </div>
            <div class="col-md-4">
                <label for="nomeFiltro" class="form-label">Buscar por nome:</label>
                <i class="ms-1 fa-regular fa-circle-question help-icon"
                    matTooltip="Pesquise clientes pelo nome completo ou parcial."></i>
                <input type="text" id="nomeFiltro" class="form-control" placeholder="Digite o nome do cliente"
                    [(ngModel)]="filtroNome" (input)="aplicarFiltros()" />
            </div>
            <table class="mt-3" id="clientes-table">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Nome</th>
                        <th>Email</th>
                        <th>CPF</th>
                        <th>Personal</th>
                        <th>Ações</th>
                    </tr>
                </thead>
                <tbody id="clientes-list">
                    @for (dados of filtrado | paginate: { itemsPerPage: 5, currentPage: paginaAtual }; track dados) {
                    <tr>
                        <td>{{dados.id}}</td>
                        <td>{{dados.nome}}</td>
                        <td>{{dados.email}}</td>
                        <td>{{dados.CPF}}</td>
                        <td>{{dados.nome_personal}}</td>
                        <td clas>
                            @if(func == 'personal'){
                            <button class="pn-button" [routerLink]="['/admin/painel/treinos/editar-fichas']"
                                [queryParams]="{ cliente_id: dados.id}">Cadastrar
                                Treinos</button>
                            }@else {
                            <button class="pn-button btn-outline-primary" title="Editar"
                                matTooltip="Editar o cliente selecionado" routerLink="editar"
                                [queryParams]="{ id: dados.id}"><i class="fas fa-edit"></i></button>
                            <button class="pn-button btn-excluir"
                                matTooltip="Exclui o cliente do sistema após confirmação." title="Excluir"
                                (click)="openmodal(dados.id)">
                                <i class="fas fa-trash"></i>
                            </button>
                            @if(func == 'Administrador'){
                            <button class="btn-treino" [routerLink]="['/admin/painel/treinos/editar-fichas']"
                                [queryParams]="{ cliente_id: dados.id}">Cad
                                Treinos</button>
                            }
                            <app-modal-confirmar (confirm)="validarmodal($event)"></app-modal-confirmar>
                            <button type="button"
                                matTooltip="Exibe todo o histórico do cliente: treinos, pagamentos, presença..."
                                title="Historico" class="pn-button" (click)="openmodalH(dados.id)"
                                data-bs-toggle="modal" data-bs-target="#exibirModal"><i
                                    class="fas fa-history"></i></button>

                            <app-modal-exibir #modalH></app-modal-exibir>
                            <button type="button" class="pn-button" title="Relatorios"
                                matTooltip="Abre relatórios detalhados deste cliente."
                                (click)="abrirModalRelatorios('relatorioClienteid', dados.id)">
                                <i class="fa-solid fa-chart-line mx-2"></i>
                            </button>
                            }
                        </td>
                    </tr>
                    }
                </tbody>
            </table>
            <div class="mt-3 d-flex align-items-center justify-content-end">
                <pagination-controls (pageChange)="paginaAtual = $event" previousLabel="Anterior"
                    nextLabel="Próximo"></pagination-controls>

                <i class="fa-regular fa-circle-question help-icon"
                    matTooltip="Navegue entre as páginas da lista de clientes."></i>
            </div>
        </div>
    </div>